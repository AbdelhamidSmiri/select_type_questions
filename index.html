
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" >
<style type="text/css">
    .custom-switch {
        padding-left: 0rem;
        width: 0px;
    }

    .custom-switch .custom-control-label::before {
        left: -2.25rem;
        width: 2.75rem;
        border-radius: 1.5rem;
        height: 19px;
    }

    .custom-switch .custom-control-label::after {
        width: 19px;
        height: 15px;
        border-radius: 1.5rem;
        left: -29px;
    }

    .custom-control-label {
        padding-left: 16px;
    }

    .custom-switch .custom-control-input:checked~.custom-control-label::after {
        -webkit-transform: translateX(15.75px);
        transform: translateX(15.75px);
    }

    /* style checkbock */
    /*----------- BUTTON ----------*/
    .btn-holder {
        width: 400px;
        height: 300px;
        margin: 50px auto 0;
    }

    .btn-lg.btn-toggle {
        padding: 0;
        margin: 0 5rem;
        position: relative;
        height: 2.5rem;
        width: 6rem;
        border-radius: 3rem;
        color: #6b7381;
        background: #bdc1c8;
        margin-bottom: 30px;
    }

    .btn-toggle.btn-lg>.switch {
        position: absolute;
        top: 0.2rem;
        left: 0.1rem;
        width: 2rem;
        height: 2rem;
        border-radius: 1.875rem;
        background: #fff;
        transition: left .25s;
    }

    .btn-toggle.active {
        background-color: #ff8800;
    }

    .btn-toggle.btn-lg.active>.switch {
        left: 3.75rem;
        transition: left .25s;
    }


    .btn-lg.btn-toggle.active:after {
        opacity: 1;
    }

    /*------------ CHECKBOX -------------*/
    .toggle-switch {
        margin: 0 auto;
        /* width: 241px; */
        margin-top: 20px;
        position: relative;
    }

    .toggle-switch label {
        padding: 0;
    }

    input.cb-switch {
        display: none;
    }

    .toggle-switch label input+span {
        position: relative;
        display: inline-block;
        margin-right: 10px;
        width: 75px;
        height: 35px;
        background: #bdc1c8;
        border: 1px solid #eee;
        border-radius: 50px;
        transition: all 0.3s ease-in-out;
        box-shadow: inset 0 0 5px #828282;
    }

    .toggle-switch label input+span small {
        position: absolute;
        display: block;
        width: 34px;
        height: 27px;
        border-radius: 1.875rem;
        background: #fff;
        transition: all 0.3s ease-in-out;
        top: 0.2rem;
        left: 0.2rem;
    }

    .toggle-switch label input:checked+span {
        background-color: #ff8800;
    }

    .toggle-switch label input:checked+span small {
        left: 35px;
        transition: left .25s;
    }

    .toggle-switch label input:checked+span:after {
        opacity: 1;
    }

    .checkbox-label {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* style row qst */
    .row_for_cp {
        display: none;
        margin: 20px 0px 20px 0px;
    }

    .input_text {
        width: 200px;
    }

    .div_inputs {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        column-gap: 15px;

    }

    .div_inputs button {
        position: absolute;
        bottom: 12px;
        right: 9px;
    }

    .div_inputs div {
        padding: 12px 0;
    }

    .all_row_cp {
        display: flex;
        flex-direction: column;
        row-gap: 19px;
        margin-top: 30px;
        border-top: 1px solid gainsboro;
        padding-top: 27px;
    }
</style>

<div class="row m-t-25">
    <div class="col"></div>
    <div class="col-sm-12 col-lg-12">
        <div class="card ">
            <div class="card-header"><strong>Ajouter une etape</strong>
            </div>

            <div class="card-body">
                <form action="/etapes/add" id="EtapeAddForm" method="post" accept-charset="utf-8" autocomplete="off"></form>
                <div class='row form-group'>
                    <input type="text" name="data[Etape][qsts]" class="qsts_input" value="">
                </div>
                <hr>
                <h2 class="mb-3">Ajouter des questions</h2>

                <div class="row">
                    <div class="col">
                        <div class="toggle-switch">
                            <label class="checkbox-label" for="multichoix">
                                <input type="checkbox" class="cb-switch" id="multichoix" value="multichoix" onchange="handleCheck(event)">
                                <span>
                                    <small></small>
                                </span>
                                <h4>Multi choix</h4>
                            </label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="toggle-switch">
                            <label class="checkbox-label" for="choix_unique">
                                <input type="checkbox" class="cb-switch" id="choix_unique" value="choix_unique" onchange="handleCheck(event)">
                                <span>
                                    <small></small>
                                </span>
                                <h4>Choix unique</h4>
                            </label>
                        </div>

                    </div>

                    <div class="col">
                        <div class="toggle-switch">
                            <label class="checkbox-label" for="image">
                                <input type="checkbox" class="cb-switch" id="image" value="image" onchange="handleCheck(event)">
                                <span>
                                    <small></small>
                                </span>
                                <h4>Image</h4>
                            </label>
                        </div>
                    </div>

                    <div class="col">
                        <div class="toggle-switch">
                            <label class="checkbox-label" for="remarque">
                                <input type="checkbox" class="cb-switch" id="remarque" value="remarque" onchange="handleCheck(event)">
                                <span>
                                    <small></small>
                                </span>
                                <h4>Remarque</h4>
                            </label>
                        </div>
                    </div>

                    <div class="col">
                        <div class="toggle-switch">
                            <label class="checkbox-label" for="autre_type">
                                <input type="checkbox" class="cb-switch" id="autre_type" value="autre_type" onchange="handleCheck(event)">
                                <span>
                                    <small></small>
                                </span>
                                <h4>Autre type</h4>
                            </label>
                        </div>
                    </div>

                </div>
                <div class="row row_for_cp ">
                    <div class="col-md-2 ">
                        <h4 class="tilte_qst"></h4>
                    </div>
                    <div onchange="handleInputs(event)" class="div_inputs col" data-id="">
                        <div class="  div_cost_input"><input type="text" class="form-control input_text" /></div>
                        <div><input type="text" class="form-control input_text" /></div>
                        <div><input type="text" class="form-control input_text" /></div>
                        <button class="btn btn-success" onclick="handelAddInput(event)">+</button>

                    </div>
                </div>
                <div class="all_row_cp">

                </div>
            </div>
            <div class="card-footer text-center">
                <button type="submit" class="btn btn-success">Envoyer</button>
            </div>
        </div>

    </div>
    <div class="col"></div>
</div>















<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

<script>
    // Declare arraychecked using let to allow modifications
    let objetchecked = {};

    function handleCheck(event) {
        var valchecked = event.target.value;
        var haschecked = event.target.checked;

        if (haschecked) {
            // Add valchecked to objetchecked
            objetchecked[valchecked] = "";
            if (valchecked == "multichoix" || valchecked == "choix_unique") {
                var row_cp = $(".row_for_cp").clone();
                $(".all_row_cp").append(row_cp.removeClass("row_for_cp").addClass("row_" + valchecked));
                $(".row_" + valchecked + " .tilte_qst").text(valchecked);
                $(".row_" + valchecked + " .div_inputs").attr("data-id", valchecked);
                $(".row_" + valchecked + " .div_inputs button").attr("data-id", valchecked);
            }
        } else {
            // Remove all occurrences of the value from objetchecked
            delete objetchecked[valchecked];
            $(".row_" + valchecked).remove();

        }
        $(".qsts_input").val(JSON.stringify(objetchecked));
        console.log(objetchecked);
    }
    function handleInputs(event) {
        var div_inputs = event.target.closest('.div_inputs');
        var dataId = div_inputs.dataset.id;


        var inputs = div_inputs.querySelectorAll('input');
        var array_provesoire = [];
        inputs.forEach(function(input) {
            if (input.value != '') {
                array_provesoire.push(input.value);
            }
        });
        var string_provesoire = array_provesoire.join('|');
        if (dataId == "multichoix") {
            objetchecked["multichoix"] = string_provesoire
        } else {
            objetchecked["choix_unique"] = string_provesoire
        }
        $(".qsts_input").val(JSON.stringify(objetchecked));
    }
    function handelAddInput(event) {
        event.preventDefault();
        var mybtn = event.target.dataset.id;
        var input_cp = $(".row_" + mybtn + " .div_cost_input").clone();
        input_cp.find('input').val("");
        $(".row_" + mybtn + " .div_inputs").append(input_cp.removeClass("div_cost_input"));
        
    }
    
</script>